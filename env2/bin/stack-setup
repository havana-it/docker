#!/bin/bash
#
# Utility for interactive stack environment config setup
# 
# Populate .env file prompting user for custom values,
# use defaults provided in .dist file if no user input
#

STACK_ROOT=$(realpath `dirname $0`/../)
ENV_FILE=.env
DIST_FILE=${ENV_FILE}.dist

source $STACK_ROOT/$DIST_FILE

# Create env file upon distributable, only if not present yet
cp --no-clobber $STACK_ROOT/$DIST_FILE $STACK_ROOT/$ENV_FILE

# Iterate over env variables, interactively allowing value override
for var in $(awk -F "=" '/^[A-Z]/ { printf "%s\n", $1; }' $STACK_ROOT/$DIST_FILE)
do
    default_value=${!var}
    printf "[%s] = ? (%s) " $var $default_value #${!var}
    read user_value
    [ -z "$user_value" ] && user_value=$default_value
        
    # FIXME Find a way to identify services
    # This would allow for service-related block skipping
    sed "s/^\(${var}=\).*$/\1$user_value/" $STACK_ROOT/$ENV_FILE
done

